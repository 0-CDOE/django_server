{% extends 'base.html' %}

{% block content %}
<style>
    .image-preview {
        max-width: 300px;
        max-height: 300px;
        margin-top: 10px;
        margin-left: 100px;
    }
    #drop-zone {
        border: 2px dashed #007bff;
        padding: 10px;
        margin-top: 10px;
        text-align: center;
        transition: background-color 0.3s ease;
    }
    #drop-zone.hover {
        background-color: #e9ecef;
    }
</style>

<div class="container">
    <h5 class="my-3 border-bottom pb-2">질문 등록</h5>

    <form method="post" class="post-form my-3" enctype="multipart/form-data">
        {% csrf_token %}

        {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                {% for field in form %}
                    {% if field.errors %}
                        <strong>{{ field.label }}</strong>
                        {{ field.errors }}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        <div class="form-group">
            <label for="subject">제목</label>
            <input type="text" name="{{ form.subject.name }}" id="subject" class="form-control" value="{{ form.subject.value|default_if_none:'' }}">
        </div>

        <div class="form-group">
            <label for="content">내용</label>
            <textarea name="content" id="content" class="form-control" rows="10">{{ form.content.value|default_if_none:'' }}</textarea>
            
            <div class="form-group">
                <label for="id_image">업로드 이미지:</label>
                <input 
                    type="file" 
                    name="image" 
                    id="id_image" 
                    accept="image/*"
                >
                <div id="drop-zone">파일을 여기에 드래그 앤 드롭 하세요</div>
            </div>  

            <div id="image-preview-container"></div>

        </div>

        <button type="submit" class="btn btn-primary">저장하기</button>

    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropZone = document.getElementById('drop-zone');
        const imageInput = document.querySelector('input[name="image"]');
        const previewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.createElement('img');
        imagePreview.classList.add('image-preview');
    
        previewContainer.appendChild(imagePreview);

        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        dropZone.addEventListener('dragover', function(event) {
            event.preventDefault();
            dropZone.classList.add('hover');
        });

        dropZone.addEventListener('dragleave', function(event) {
            event.preventDefault();
            dropZone.classList.remove('hover');
        });

        dropZone.addEventListener('drop', function(event) {
            event.preventDefault();
            dropZone.classList.remove('hover');
            const files = event.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                imageInput.files = files;  // 드롭된 파일을 input에 반영
                previewImage(files[0]);
            } else {
                imagePreview.src = '';
            }
        });

        imageInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                previewImage(file);
            } else {
                imagePreview.src = '';
            }
        });
    });
</script>
{% endblock %}
